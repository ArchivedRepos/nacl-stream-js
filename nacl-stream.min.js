!function(t,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports.stream=e(require("tweetnacl/nacl-fast")):t.nacl.stream=e(t.nacl)}(this,function(t){"use strict";function e(t){for(var e=16;24>e&&(t[e]++,!t[e]);e++);}function n(t){t[23]|=128}function r(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t],n=0;n<e.length;n++)e[n]=0}function i(t,e){if(32!==t.length)throw new Error("bad key length, must be 32 bytes");if(16!==e.length)throw new Error("bad nonce length, must be 16 bytes")}function o(t,e){i(t,e),this._key=t,this._fullNonce=new Uint8Array(24),this._fullNonce.set(e),this._in=new Uint8Array(u+s),this._out=new Uint8Array(u+s)}function l(t,e){i(t,e),this._key=t,this._fullNonce=new Uint8Array(24),this._fullNonce.set(e),this._in=new Uint8Array(u+s),this._out=new Uint8Array(u+s),this._failed=!1}if(!t)throw new Error("tweetnacl not loaded");var s=65535,u=t.lowlevel.crypto_secretbox_ZEROBYTES,h=t.lowlevel.crypto_secretbox_BOXZEROBYTES,c=t.lowlevel.crypto_secretbox,f=t.lowlevel.crypto_secretbox_open;return o.prototype.encryptChunk=function(t,r){var i=t.length;if(i>s)throw new Error("chunk is too large");for(var o=0;u>o;o++)this._in[o]=0;this._in.set(t,u),r&&n(this._fullNonce),c(this._out,this._in,i+u,this._fullNonce,this._key),e(this._fullNonce);var l=this._out.subarray(h-2,h-2+i+16+2);return l[0]=i>>>0&255,l[1]=i>>>8&255,l},o.prototype.clean=function(){r(this._fullNonce,this._in,this._out)},l.prototype._fail=function(){return this._failed=!0,this.clean(),null},l.prototype.readLength=function(t){return t.length<2?-1:t[0]|t[1]<<8},l.prototype.decryptChunk=function(t,r){if(this._failed)return null;var i=t.length;if(2+h>i)return this._fail();var o=this.readLength(t);if(0>o||o>s)return this._fail();if(o+2+h!==i)return this._fail();for(var l=0;h>l;l++)this._in[l]=0;for(l=0;i-2>l;l++)this._in[h+l]=t[l+2];return r&&n(this._fullNonce),0!==f(this._out,this._in,i+h-2,this._fullNonce,this._key)?this._fail():(e(this._fullNonce),this._out.subarray(u,u+o))},l.prototype.clean=function(){r(this._fullNonce,this._in,this._out)},{createEncryptor:function(t,e){return new o(t,e)},createDecryptor:function(t,e){return new l(t,e)},maxChunkLength:s}});