!function(t,n){"use strict";"undefined"!=typeof module&&module.exports?module.exports.stream=n(require("tweetnacl/nacl-fast")):t.nacl.stream=n(t.nacl)}(this,function(t){"use strict";function n(t){for(var n=0;8>n&&(t[n]++,!t[n]);n++);}function r(t){t[7]|=128}function e(){for(var t=0;t<arguments.length;t++)for(var n=arguments[t],r=0;r<n.length;r++)n[r]=0}function i(t,n){return n|=0,t.length<n+4?-1:t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24}function h(t,n,r){if(32!==t.length)throw new Error("bad key length, must be 32 bytes");if(16!==n.length)throw new Error("bad nonce length, must be 16 bytes");if(r>=4294967295)throw new Error("max chunk length is too large");if(16>r)throw new Error("max chunk length is too small")}function o(t,n){var r=new Uint8Array(32);return y(r,n,t,m),r}function u(t,n,r,e,i){var h;if(32>r)return-1;for(k(t,0,n,0,r,e,i),p(t,16,t,32,r-32,t),h=0;16>h;h++)t[h]=0;return 0}function s(t,n,r,e,i){var h,o=new Uint8Array(32);if(32>r)return-1;if(w(o,0,32,e,i),0!==g(n,16,n,32,r-32,o))return-1;for(k(t,0,n,0,r,e,i),h=0;32>h;h++)t[h]=0;return 0}function a(t,n,r){h(t,n,r),this._subkey=o(t,n),this._chunkCounter=new Uint8Array(8),this._maxChunkLength=r||_,this._in=new Uint8Array(c+this._maxChunkLength),this._out=new Uint8Array(c+this._maxChunkLength),this._done=!1}function l(t,n,r){h(t,n,r),this._subkey=o(t,n),this._chunkCounter=new Uint8Array(8),this._maxChunkLength=r||_,this._in=new Uint8Array(c+this._maxChunkLength),this._out=new Uint8Array(c+this._maxChunkLength),this._failed=!1,this._done=!1}if(!t)throw new Error("tweetnacl not loaded");var _=65535,c=t.lowlevel.crypto_secretbox_ZEROBYTES,f=t.lowlevel.crypto_secretbox_BOXZEROBYTES,y=t.lowlevel.crypto_core_hsalsa20,w=t.lowlevel.crypto_stream_salsa20,k=t.lowlevel.crypto_stream_salsa20_xor,p=t.lowlevel.crypto_onetimeauth,g=t.lowlevel.crypto_onetimeauth_verify,m=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);return a.prototype.encryptChunk=function(t,e){if(this._done)throw new Error("called encryptChunk after last chunk");var i=t.length;if(i>this._maxChunkLength)throw new Error("chunk is too large: "+i+" / "+this._maxChunkLength);for(var h=0;c>h;h++)this._in[h]=0;this._in.set(t,c),e&&(r(this._chunkCounter),this._done=!0),u(this._out,this._in,i+c,this._chunkCounter,this._subkey),n(this._chunkCounter);var o=this._out.subarray(f-4,f-4+i+16+4);return o[0]=i>>>0&255,o[1]=i>>>8&255,o[2]=i>>>16&255,o[3]=i>>>24&255,new Uint8Array(o)},a.prototype.clean=function(){e(this._chunkCounter,this._in,this._out)},l.prototype._fail=function(){return this._failed=!0,this.clean(),null},l.prototype.decryptChunk=function(t,e){if(this._failed)return null;if(this._done)throw new Error("called decryptChunk after last chunk");var h=t.length;if(4+f>h)return this._fail();var o=i(t);if(0>o||o>this._maxChunkLength)return this._fail();if(o+4+f!==h)return this._fail();for(var u=0;f>u;u++)this._in[u]=0;for(u=0;h-4>u;u++)this._in[f+u]=t[u+4];return e&&(r(this._chunkCounter),this._done=!0),0!==s(this._out,this._in,h+f-4,this._chunkCounter,this._subkey)?this._fail():(n(this._chunkCounter),new Uint8Array(this._out.subarray(c,c+o)))},l.prototype.clean=function(){e(this._chunkCounter,this._in,this._out)},{createEncryptor:function(t,n,r){return new a(t,n,r)},createDecryptor:function(t,n,r){return new l(t,n,r)},readChunkLength:i}});