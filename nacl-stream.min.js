!function(t,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports.stream=e(require("tweetnacl/nacl-fast")):t.nacl.stream=e(t.nacl)}(this,function(t){"use strict";function e(t){for(var e=16;24>e&&(t[e]++,!t[e]);e++);}function n(t){t[23]|=128}function r(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t],n=0;n<e.length;n++)e[n]=0}function i(t,e){if(32!==t.length)throw new Error("bad key length, must be 32 bytes");if(16!==e.length)throw new Error("bad nonce length, must be 16 bytes")}function o(t,e){i(t,e),this._key=t,this._fullNonce=new Uint8Array(24),this._fullNonce.set(e),this._in=new Uint8Array(l+h),this._out=new Uint8Array(l+h),this._done=!1}function s(t,e){i(t,e),this._key=t,this._fullNonce=new Uint8Array(24),this._fullNonce.set(e),this._in=new Uint8Array(l+h),this._out=new Uint8Array(l+h),this._failed=!1,this._done=!1}if(!t)throw new Error("tweetnacl not loaded");var h=65535,l=t.lowlevel.crypto_secretbox_ZEROBYTES,u=t.lowlevel.crypto_secretbox_BOXZEROBYTES,c=t.lowlevel.crypto_secretbox,a=t.lowlevel.crypto_secretbox_open;return o.prototype.encryptChunk=function(t,r){if(this._done)throw new Error("called encryptChunk after last chunk");var i=t.length;if(i>h)throw new Error("chunk is too large");for(var o=0;l>o;o++)this._in[o]=0;this._in.set(t,l),r&&(n(this._fullNonce),this._done=!0),c(this._out,this._in,i+l,this._fullNonce,this._key),e(this._fullNonce);var s=this._out.subarray(u-2,u-2+i+16+2);return s[0]=i>>>0&255,s[1]=i>>>8&255,new Uint8Array(s)},o.prototype.clean=function(){r(this._fullNonce,this._in,this._out)},s.prototype._fail=function(){return this._failed=!0,this.clean(),null},s.prototype.readLength=function(t){return t.length<2?-1:t[0]|t[1]<<8},s.prototype.decryptChunk=function(t,r){if(this._failed)return null;if(this._done)throw new Error("called decryptChunk after last chunk");var i=t.length;if(2+u>i)return this._fail();var o=this.readLength(t);if(0>o||o>h)return this._fail();if(o+2+u!==i)return this._fail();for(var s=0;u>s;s++)this._in[s]=0;for(s=0;i-2>s;s++)this._in[u+s]=t[s+2];return r&&(n(this._fullNonce),this._done=!0),0!==a(this._out,this._in,i+u-2,this._fullNonce,this._key)?this._fail():(e(this._fullNonce),new Uint8Array(this._out.subarray(l,l+o)))},s.prototype.clean=function(){r(this._fullNonce,this._in,this._out)},{createEncryptor:function(t,e){return new o(t,e)},createDecryptor:function(t,e){return new s(t,e)},maxChunkLength:h}});